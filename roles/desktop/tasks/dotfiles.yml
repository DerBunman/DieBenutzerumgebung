- name: "Deploying desktop dotfiles for {{ user.name }}"
  block:
    - name: "Copy dotfiles for {{ user.name }}"
      copy:
        src: "dotfiles/"
        dest: "{{ user.home }}/"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: g=-rwx,o=-rwx
        directory_mode: 0700
        force: yes

    - name: "Generate oomox colorscheme"
      template:
        src:  oomox-colors-DieOberflaechengestaltung.j2
        dest: "{{ user.home }}/.config/oomox/colors/DieOberflaechengestaltung"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0600

    - name: "Generate ~/.Xresources"
      template:
        src:  Xressources.j2
        dest: "{{ user.home }}/.Xresources"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0600

    - name: "Mkdir {{ user.home }}/.config/i3/config"
      file:
        path: "{{ user.home }}/.config/i3"
        state: directory
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0700

    - name: "Generate {{ user.home }}/.config/i3/config"
      template:
        src:  i3_conf.j2
        dest: "{{ user.home }}/.config/i3/config"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0600

    - name: "Build DieOberflaechengestaltung GTK2/3 themes"
      command: oomox-cli --make-opts all ~/.config/oomox/colors/DieOberflaechengestaltung
      changed_when: False

    - name: "Build DieOberflaechengestaltung icons"
      command: oomox-gnome-colors-icons-cli ~/.config/oomox/colors/DieOberflaechengestaltung
      changed_when: False

    - name: "Creates directory ~/.config/rofi/"
      file:
        path: "{{ user.home }}/.config/rofi/"
        state: directory
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0700

    - name: "Generate ~/.config/rofi/config.rasi"
      template:
        src:  config.rasi.j2
        dest: "{{ user.home }}/.config/rofi/config.rasi"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0600
      tags:
        - rofi

    - name: "Generate ~/.config/rofi/DieBenutzerumgebung.rasi"
      template:
        src:  DieBenutzerumgebung.rasi.j2
        dest: "{{ user.home }}/.config/rofi/DieBenutzerumgebung.rasi"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0600
      tags:
        - rofi


    - name: "Generate rofi_media_menu.conf"
      template:
        src:  rofi_media_menu.conf.j2
        dest: "{{ user.home }}/.config/rofi_media_menu.conf"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0600

    - name: "Generate {{ user.home }}/bin/polybar-scripts/inbox-imap-shellnetrc.sh"
      template:
        src:  inbox-imap-shellnetrc.sh.j2
        dest: "{{ user.home }}/bin/polybar-scripts/inbox-imap-shellnetrc.sh"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0700

    - name: "Setting executable permissions for some dotfiles"
      file:
        state: touch
        path: "~/{{ item }}"
        mode: u+rwx
        modification_time: preserve
        access_time: preserve
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
      become_user: "{{ user.name }}"
      loop: "{{ desktop__dotfiles_executable }}"

    - name: "Generate {{ user.home }}/.config/polybar/config"
      template:
        src:  polybar/config.j2
        dest: "{{ user.home }}/.config/polybar/config"
        owner: "{{ user.name }}"
        group: "{{ user.group }}"
        mode: 0600

  become_user: "{{ user.name }}"
